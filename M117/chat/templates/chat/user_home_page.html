<!DOCTYPE html>
<head>
  <title> #ChitChatCity </title>
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static "/chat/stylesheet/font-awesome-4.7.0/css/font-awesome.min.css" %}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<style>

button{
     background-color: white;
     border-style: solid;
     border-width: 3px;
     border-radius: 10px;
     border-color: #db3236;
     color:#db3236;
}

tr.changepos:hover {
    background-color: #ECF6EC;
}

tr.changeneg:hover {
    background-color: #FFF1F1;
}

</style>
<body>
     <div style=" margin: 10px; border: 3px solid; border-radius: 10px; min-height: 400px;">
          <div style=" margin: 10px;">
               <div style="float: left;">
                    <h1> Hi {{fname}} </h1>
               </div>

               <div style="font-size: 20px; margin: 20px; float: right;">
                    <form method="POST">
                         {% csrf_token %}
                         <button class="button button1" type="submit"> logout </button>
                    </form>
               </div>

               <div style="clear: both;">
               <h2> Welcome to #ChitChatCity homepage! </h1>
               <h3> Choose the ChatRoom you want to join :</h3>
               </div>
               <div>
                    <div style="width: 1000px;">
                         <a href="../Action/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Action</h4>
                              </div>
                         </a>
                         <a href="../Adventure/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Adventure</h4>
                              </div>
                         </a>
                         <a href="../Animation/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Animation</h4>
                              </div>
                         </a>
                         <a href="../Biography/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Biography</h4>
                              </div>
                         </a>
                         <a href="../Comedy/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Comedy</h4>
                              </div>
                         </a>
                         <a href="../Crime/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Crime</h4>
                              </div>
                         </a>
                         <a href="../Documentary/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Documentary</h4>
                              </div>
                         </a>
                         <a href="../Drama/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Drama</h4>
                              </div>
                         </a>
                         <a href="../Family/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Family</h4>
                              </div>
                         </a>
                         <a href="../Fantasy/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Fantasy</h4>
                              </div>
                         </a>
                         <a href="../FilmNoir/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">FilmNoir</h4>
                              </div>
                         </a>
                         <a href="../History/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">History</h4>
                              </div>
                         </a>
                         <a href="../Horror/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Horror</h4>
                              </div>
                         </a>
                         <a href="../Music/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Music</h4>
                              </div>
                         </a>
                         <a href="../Musical/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Musical</h4>
                              </div>
                         </a>
                         <a href="../Mystery/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Mystery</h4>
                              </div>
                         </a>
                         <a href="../Romance/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Romance</h4>
                              </div>
                         </a>
                         <a href="../SciFic/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">SciFic</h4>
                              </div>
                         </a>
                         <a href="../Sport/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Sport</h4>
                              </div>
                         </a>
                         <a href="../Thriller/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Thriller</h4>
                              </div>
                         </a>
                         <a href="../War/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">War</h4>
                              </div>
                         </a>
                         <a href="../Western/{{uname}}">
                              <div style="text-align: center; width: 130px; float: left; margin: 10px 10px 10px 0px; border: 3px solid; border-radius: 10px;">
                                   <h4 style="margin: 5px">Western</h4>
                              </div>
                         </a>
                    </div>
               </div>
          </div>

          <div  style="clear: both; margin:10px; padding-top: 10px;">
               <h3> Click on user to start private conversation</h3>
               <div id="all-users" class="all-users" style="font-size: 18px;">
               </div>
               <script>
                    function compare(foo1,foo2){
                         var count = 0;
                         if( foo1["fields"]["Action"] === foo2["fields"]["Action"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Adventure"] === foo2["fields"]["Adventure"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Animation"] === foo2["fields"]["Animation"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Biography"] === foo2["fields"]["Biography"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Comedy"] === foo2["fields"]["Comedy"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Crime"] === foo2["fields"]["Crime"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Documentary"] === foo2["fields"]["Documentary"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Drama"] === foo2["fields"]["Drama"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Family"] === foo2["fields"]["Family"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Fantasy"] === foo2["fields"]["Fantasy"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["FilmNoir"] === foo2["fields"]["FilmNoir"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["History"] === foo2["fields"]["History"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Horror"] === foo2["fields"]["Horror"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Music"] === foo2["fields"]["Music"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Musical"] === foo2["fields"]["Musical"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Mystery"] === foo2["fields"]["Mystery"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Romance"] === foo2["fields"]["Romance"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["SciFi"] === foo2["fields"]["SciFi"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Sport"] === foo2["fields"]["Sport"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Thriller"] === foo2["fields"]["Thriller"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["War"] === foo2["fields"]["War"] ){
                              count = count + 1;
                         }
                         if( foo1["fields"]["Western"] === foo2["fields"]["Western"] ){
                              count = count + 1;
                         }

                         return count;
                    }

                    function toHex(str) {
                    	var hex = '';
                    	for(var i=0;i<str.length;i++) {
                    		hex += ''+str.charCodeAt(i).toString(16);
                    	}
                    	return hex;
                    }


                    function addHexColor(c1, c2) {
                      var hexStr = (parseInt(c1, 16) + parseInt(c2, 16)).toString(16);
                      while (hexStr.length < 6) { hexStr = '0' + hexStr; } // Zero pad.
                      return hexStr;
                    }


                    function compare2(a,b) {
                      if (a.value < b.value)
                        return -1;
                      if (a.value > b.value)
                        return 1;
                      return 0;
                    }

                    var myself = JSON.parse("{{myself|escapejs}}")[0];

                    var all_users = JSON.parse("{{all_user|escapejs}}");

                    newlist = []

                    for(i=0; i<all_users.length; i++){
                         value = compare(myself,all_users[i])
                         all_users[i]['value'] = value
                    }

                    all_users = all_users.sort(compare2).reverse() ;

                    uname = "{{uname}}";
                    document.getElementById("all-users").innerHTML = "";


                    var str = "<table class='table'><thead><tr><th>Status</th><th>Name</th><th>School</th><th style ='text-align: center;' > Interest Ratio </th></tr></thead><tbody>";

                    for(i=0; i<all_users.length; i++){

                         new_uname = all_users[i]["fields"]["user_name"];
                         first_name = all_users[i]["fields"]["first_name"];
                         last_name = all_users[i]["fields"]["last_name"];
                         school = all_users[i]["fields"]["school"];
                         value = all_users[i]["value"];
                         console.log(all_users[0])
                         state = parseInt(all_users[i]["fields"]["state"]);

                         if(state){
                              str = str + "<tr class='changepos'><td>" + '<i class="fa fa-smile-o fa-2x" aria-hidden="true" style="color: #3cba54;"></i></td>'
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div>" + " " + first_name + " " + last_name + "</div></td></a>";
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div>" + school + "</div></td></a>";
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div align='center'>" + value + "</div></td></a></tr>";
                         }
                         else{
                              str = str + "<tr class='changeneg'><td>" + '<i class="fa fa-frown-o fa-2x" aria-hidden="true" style="color: #db3236;"></i></td>'
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div>" + " " + first_name + " " + last_name + "</div></td></a>";
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div>" + school + "</div></td></a>";
                              str = str + "<td>" + "<a style='text-decoration: none; color: black;' href='../private/" + addHexColor(toHex(new_uname),toHex(uname)) + "/" + uname + "/" + "'>" + "<div align='center'>" + value + "</div></td></a></tr>";
                         }

                    }

                    str = str + '</tbody></table>'

                    document.getElementById("all-users").innerHTML = str;
               </script>
          </div>
     </div>


</body>
